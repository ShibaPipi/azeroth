## 计算机指令的执行过程

>### 指令执行过程
* 步骤
    * 取指令 → 分析指令 → 执行指令
    
        | 取指令 | 分析指令 | 执行指令 |
        | :----: | :----: | :----: |
        | 从缓存中取指令 → 送到指令寄存器 | 指令译码器译码 → 发出控制信号 → 程序计数器 +1 | 装载数据到寄存器 → ALU 处理数据 → 记录运算状态 → 送出运算结果|
    
* 涉及设备
    * 高速缓存
        * 数据缓存
        * 指令缓存
    * 运算器
        * 寄存器
        * 数据缓存器
        * 状态字寄存器
    * 控制器
        * 程序计数器
        * 指令译码器
        * 时序发生器
        * 指令寄存器

>### CPU 流水线设计
* 存在问题
    * CPU 的运算器和控制器不能同时工作，因此综合利用率不高
* 设计思想
    * 类似工厂的装配线
    * 工厂的装配线使得多个产品可以同时被加工
    * 在同一个时刻，不同产的品均位于不同的加工阶段
* 未应用流水线设计之前 CPU 的指令执行
    
    | 时间片 | 时间片 | 时间片 | 时间片 | 时间片 | 时间片 | 时间片 | 时间片 | 时间片 |
    | :----: | :----: | :----: | :----: | :----: | :----: | :----: | :----: | :----: |
    | 取指令 | 分析指令 | 执行指令 | 取指令 | 分析指令 | 执行指令 | 取指令 | 分析指令 | 执行指令 |
        
* 应用后
    
    | 指令 | 时间片 | 时间片 | 时间片 | 时间片 | 时间片 | 时间片 | 时间片 | 时间片 | 时间片 |
    | :----:| :----: | :----: | :----: | :----: | :----: | :----: | :----: | :----: | :----: |
    | 1 | 取指令 | 分析指令 | 执行指令 |
    | 2 |  | 取指令 | 分析指令 | 执行指令 |
    | 3 |  |  | 取指令 | 分析指令 | 执行指令 |
    | 4 |  |  |  | 取指令 | 分析指令 | 执行指令 |
    | 5 |  |  |  |  | 取指令 | 分析指令 | 执行指令 |
    | 6 |  |  |  |  |  | 取指令 | 分析指令 | 执行指令 |
    | 7 |  |  |  |  |  |  | 取指令 | 分析指令 | 执行指令 |

* 效率提升
    * 假设取指令，分析指令，执行指令所需的时间均为 t
    * 串行执行 m 条指令：T<sub>1</sub> = 3t * m
    * 流水线执行 m 条指令：T<sub>2</sub> = t * ( m + 2 )
    * H = T<sub>2</sub> / T<sub>1</sub> = t * ( m + 2 ) / ( 3t * m ) = 1 / 3 + 1 / 3m ≈ 1 / 3
